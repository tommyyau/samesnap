# QA Audit Baseline

> This file is generated by `/qa-init` and serves as the reference for all subsequent `/qa` runs.
> Do not edit manually unless updating the contract.

## Project Structure

<!-- Populated by /qa-init -->

### Source Layout
```
/
├── components/     # React UI components
├── hooks/          # React hooks (state management)
├── party/          # PartyKit server logic
├── shared/         # Shared types and protocol
├── utils/          # Helper functions
└── test-*.mjs      # Test suites
```

### Key Files
| Purpose | File |
|---------|------|
| Server logic | `party/index.ts` |
| Multiplayer hook | `hooks/useMultiplayerGame.ts` |
| Message protocol | `shared/protocol.ts` |
| State types | `shared/types.ts` |

---

## Documented Contracts

### Message Protocol
<!-- List all client→server and server→client message types -->

### State Invariants
<!-- List invariants from AGENTS.md and LESSONS-LEARNED -->

### Known Patterns to Check
<!-- React closure issues, timer cleanup, etc. -->

---

## Critical Flows

### Join Flow
- Steps: connect → join message → room_state response → player_joined broadcast
- Guards: room full, game in progress, duplicate handling

### Config Flow
- Steps: host sets config → config_updated broadcast → clients sync
- Guards: only host can set, only in WAITING phase

### Countdown Flow
- Steps: target reached → countdown starts → tick every second → startGame
- Guards: player leaving cancels, phase check on tick

### Gameplay Flow
- Steps: round_start → match attempts → arbitration → round_winner → next round
- Guards: phase check, penalty check, valid symbol check

### Reconnect Flow
- Steps: disconnect → grace period → reconnect with ID → state restored
- Guards: ID validation, grace period expiry

### Kick Flow
- Steps: host sends kick → player_left broadcast → kicked player callback
- Guards: only host can kick, callback must fire

---

## Test Inventory

| Suite | File | Tests | Coverage Notes |
|-------|------|-------|----------------|
| Logic | test-game-logic.mjs | 17 | Deck generation, Dobble properties |
| Multiplayer | test-multiplayer.mjs | 18 | Room management, game flow |
| Hook State | test-hook-state.mjs | 25 | Message handling simulation |
| Stress | test-multiplayer-stress.mjs | 24 | Rapid fire, reconnection |

### Coverage Gaps
<!-- List known gaps that tests don't cover -->

---

## Baseline Established

Date: <!-- filled by /qa-init -->
Commit: <!-- filled by /qa-init -->
Confidence: <!-- filled by /qa-init -->
